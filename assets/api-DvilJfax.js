import{s as a}from"./index-DO7n6nzw.js";async function d(r){const{data:e,error:t}=await a.from("platform_config").select("config_value").eq("config_key",r).maybeSingle();return t?(console.error("获取平台配置失败:",t),null):(e==null?void 0:e.config_value)||null}async function f(r){const{data:{user:e}}=await a.auth.getUser();if(!e)return!1;const{error:t}=await a.from("profiles").update({wallet_activated:!0,activation_paid_amount:r,activation_paid_at:new Date().toISOString()}).eq("id",e.id);return t?(console.error("激活钱包失败:",t),!1):!0}async function u(){const{data:{user:r}}=await a.auth.getUser();if(!r)return null;const{data:e,error:t}=await a.from("profiles").select("*").eq("id",r.id).maybeSingle();return t?(console.error("获取用户Profile失败:",t),null):e}async function g(r){const{data:{user:e}}=await a.auth.getUser();if(!e)return!1;const{error:t}=await a.from("profiles").update(r).eq("id",e.id);return t?(console.error("更新Profile失败:",t),!1):!0}async function _(){const{data:{user:r}}=await a.auth.getUser();if(!r)return!1;const e=new Date().toISOString().split("T")[0],{data:t,error:s}=await a.from("mining_records").select("id").eq("user_id",r.id).eq("mining_date",e).maybeSingle();return s?(console.error("检查挖矿记录失败:",s),!1):!!t}async function w(r){const{data:{user:e}}=await a.auth.getUser();if(!e)return{success:!1,message:"未登录"};const t=new Date().toISOString().split("T")[0],{error:s}=await a.from("mining_records").insert({user_id:e.id,amount:r,mining_date:t});if(s)return console.error("创建挖矿记录失败:",s),{success:!1,message:"创建挖矿记录失败: "+s.message};const{error:n}=await a.rpc("increment_balance",{user_id:e.id,amount:r});if(n){console.warn("RPC调用失败，尝试直接更新:",n);const i=await u();if(!i)return{success:!1,message:"获取用户信息失败，请稍后重试"};const{error:o}=await a.from("profiles").update({htp_balance:i.htp_balance+r}).eq("id",e.id);if(o)return console.error("更新余额失败:",o),{success:!1,message:"更新余额失败: "+o.message}}return a.from("transactions").insert({user_id:e.id,type:"mining",amount:r,token_type:"HTP",status:"completed",description:"每日挖矿奖励"}).then(({error:i})=>{i&&console.error("创建交易记录失败:",i)}),{success:!0}}async function m(r=50){const{data:{user:e}}=await a.auth.getUser();if(!e)return[];const{data:t,error:s}=await a.from("mining_records").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(r);return s?(console.error("获取挖矿记录失败:",s),[]):Array.isArray(t)?t:[]}async function y(r=50){const{data:{user:e}}=await a.auth.getUser();if(!e)return[];const{data:t,error:s}=await a.from("transactions").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(r);return s?(console.error("获取交易记录失败:",s),[]):Array.isArray(t)?t:[]}async function p(){const{data:{user:r}}=await a.auth.getUser();if(!r)return[];const{data:e,error:t}=await a.from("invitations").select("*").eq("inviter_id",r.id).order("created_at",{ascending:!1});return t?(console.error("获取邀请列表失败:",t),[]):Array.isArray(e)?e:[]}async function h(){const{data:{user:r}}=await a.auth.getUser();if(!r)return!1;const{error:e}=await a.from("master_node_applications").insert({user_id:r.id,status:"pending",activated_wallets:0,target_wallets:1e5,total_rewards:0});return e?(console.error("申请主节点失败:",e),!1):!0}async function q(){const{data:{user:r}}=await a.auth.getUser();if(!r)return null;const{data:e,error:t}=await a.from("master_node_applications").select("*").eq("user_id",r.id).order("applied_at",{ascending:!1}).limit(1).maybeSingle();return t?(console.error("获取主节点申请失败:",t),null):e}async function A(){const{data:r,error:e}=await a.from("master_node_applications").select("*").order("applied_at",{ascending:!1});return e?(console.error("获取所有主节点申请失败:",e),[]):Array.isArray(r)?r:[]}async function S(r,e,t,s){const{data:{user:n}}=await a.auth.getUser();if(!n)return!1;const{error:i}=await a.from("withdrawal_requests").insert({user_id:n.id,amount:r,token_type:e,to_address:t,status:"pending",payment_address:s||null});return i?(console.error("创建提币请求失败:",i),!1):!0}async function v(){const{data:{user:r}}=await a.auth.getUser();if(!r)return[];const{data:e,error:t}=await a.from("withdrawal_requests").select("*").eq("user_id",r.id).order("created_at",{ascending:!1});return t?(console.error("获取提币请求失败:",t),[]):Array.isArray(e)?e:[]}async function U(){const{data:r,error:e}=await a.from("withdrawal_requests").select("*").order("created_at",{ascending:!1});return e?(console.error("获取所有提币请求失败:",e),[]):Array.isArray(r)?r:[]}async function b(r,e,t){const{data:{user:s}}=await a.auth.getUser();if(!s)return!1;const{error:n}=await a.from("withdrawal_requests").update({status:e,reviewed_at:new Date().toISOString(),reviewed_by:s.id,reject_reason:t||null}).eq("id",r);return n?(console.error("审核提币请求失败:",n),!1):!0}async function P(){const{data:r,error:e}=await a.from("profiles").select("*").order("created_at",{ascending:!1});return e?(console.error("获取所有用户失败:",e),[]):Array.isArray(r)?r:[]}async function M(r,e){const{error:t}=await a.from("profiles").update({role:e}).eq("id",r);return t?(console.error("更新用户角色失败:",t),!1):!0}async function c(r){const{data:e,error:t}=await a.from("system_settings").select("setting_value").eq("setting_key",r).maybeSingle();return t?(console.error("获取系统设置失败:",t),null):(e==null?void 0:e.setting_value)||null}async function T(r,e){const{data:{user:t}}=await a.auth.getUser();if(!t)return!1;const{error:s}=await a.from("system_settings").update({setting_value:e,updated_by:t.id}).eq("setting_key",r);return s?(console.error("更新系统设置失败:",s),!1):!0}async function k(){if(await c("htp_price_mode")==="manual"){const e=await c("htp_price");return e?parseFloat(e):.01}else{const e=new Date("2025-01-01");return .01+Math.floor((new Date().getTime()-e.getTime())/(1e3*60*60*24))*.03}}export{k as a,p as b,_ as c,q as d,h as e,y as f,m as g,d as h,v as i,f as j,S as k,P as l,U as m,A as n,c as o,w as p,M as q,b as r,T as s,g as u};
