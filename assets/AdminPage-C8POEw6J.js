import{c as ye,j as e,e as we,r,g as _e,U as Ce,N as Se,b as c,h as Te,B as o,t as i,W as De,s as ae}from"./index-Ba4E4pES.js";import{C as h,b as m,c as j,a as u,d as _}from"./card-92zAm1__.js";import{T as Pe,a as ke,b as U,c as A}from"./tabs-DXt6owXE.js";import{T as B,a as O,b as N,c as a,d as $,e as t}from"./table-CMVRFs7l.js";import{D as te,b as re,c as le,d as ne,e as ie}from"./dialog-Bon2pnkF.js";import{L as x,I as C}from"./label-apfEMgnZ.js";import{h as He,l as Ue,m as Ae,n as Fe,o as ce,a as Le,q as ze,r as Re,s as de}from"./api-DByx_AdG.js";import{L as v}from"./loader-circle-DvYxkd0y.js";import{T as Me}from"./trending-up-uqJgywOm.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],We=ye("file-check",Ee);function qe({className:g,...F}){return e.jsx("textarea",{"data-slot":"textarea",className:we("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",g),...F})}function Xe(){const[g,F]=r.useState([]),[L,oe]=r.useState([]),[z,xe]=r.useState([]),[R,I]=r.useState(!0),[d,f]=r.useState({open:!1,type:null,id:null,action:null}),[M,S]=r.useState(""),[T,D]=r.useState(!1),[V,G]=r.useState(""),[b,J]=r.useState(""),[K,Q]=r.useState(!1),[l,y]=r.useState(null),[he,P]=r.useState(!1),[w,X]=r.useState("auto"),[me,je]=r.useState(.01),[k,Y]=r.useState(""),[Z,ee]=r.useState(!1);r.useEffect(()=>{H(),ue(),E()},[]);const ue=async()=>{const s=await He("developer_usdt_address");s&&(G(s),J(s))},H=async()=>{I(!0);const[s,n,p]=await Promise.all([Ue(),Ae(),Fe()]);F(s),oe(n),xe(p),I(!1)},pe=async(s,n)=>{await ze(s,n)?(i.success("角色更新成功"),await H()):i.error("角色更新失败")},ge=async()=>{if(!(!d.id||!d.action)){if(d.action==="reject"&&!M.trim()){i.error("请填写拒绝原因");return}D(!0),d.type==="withdrawal"&&(await Re(d.id,d.action==="approve"?"approved":"rejected",d.action==="reject"?M:void 0)?(i.success(d.action==="approve"?"提币申请已通过":"提币申请已拒绝"),await H(),f({open:!1,type:null,id:null,action:null}),S("")):i.error("操作失败")),D(!1)}},ve=async()=>{if(!b.trim()){i.error("请输入有效的钱包地址");return}Q(!0);const{error:s}=await ae.from("platform_config").update({config_value:b}).eq("config_key","developer_usdt_address");Q(!1),s?i.error("更新失败"):(i.success("开发者地址更新成功"),G(b))},E=async()=>{const s=await ce("htp_price_mode");X(s||"auto");const n=await Le();if(je(n),s==="manual"){const p=await ce("htp_price");Y(p||"")}},se=async s=>{await de("htp_price_mode",s)?(X(s),i.success(`已切换到${s==="auto"?"自动":"手动"}模式`),await E()):i.error("切换失败")},fe=async()=>{const s=parseFloat(k);if(isNaN(s)||s<=0){i.error("请输入有效的价格");return}ee(!0);const n=await de("htp_price",s.toString());ee(!1),n?(i.success("HTP价格更新成功"),await E()):i.error("更新失败")},Ne=s=>{y({...s}),P(!0)},be=async()=>{if(!l)return;D(!0);const{error:s}=await ae.from("profiles").update({htp_balance:l.htp_balance,usdt_balance:l.usdt_balance,wallet_activated:l.wallet_activated,role:l.role}).eq("id",l.id);D(!1),s?i.error("更新失败"):(i.success("用户信息更新成功"),P(!1),await H())},W=L.filter(s=>s.status==="pending"),q=z.filter(s=>s.status==="pending");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold gradient-text flex items-center gap-2",children:[e.jsx(_e,{className:"w-8 h-8"}),"管理后台"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"管理用户、审核申请和查看统计数据"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(h,{className:"glow-border",children:[e.jsx(m,{className:"pb-2",children:e.jsxs(j,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),"总用户数"]})}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold",children:g.length})})]}),e.jsxs(h,{className:"glow-border",children:[e.jsx(m,{className:"pb-2",children:e.jsxs(j,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),"待审核提币"]})}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-500",children:W.length})})]}),e.jsxs(h,{className:"glow-border",children:[e.jsx(m,{className:"pb-2",children:e.jsxs(j,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),"待审核主节点"]})}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-500",children:q.length})})]}),e.jsxs(h,{className:"glow-border",children:[e.jsx(m,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium",children:"主节点数量"})}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold text-primary",children:g.filter(s=>s.is_master_node).length})})]})]}),e.jsxs(Pe,{defaultValue:"users",className:"space-y-4",children:[e.jsxs(ke,{children:[e.jsx(U,{value:"users",children:"用户管理"}),e.jsxs(U,{value:"withdrawals",children:["提币审核",W.length>0&&e.jsx(c,{variant:"destructive",className:"ml-2",children:W.length})]}),e.jsxs(U,{value:"masternodes",children:["主节点审核",q.length>0&&e.jsx(c,{variant:"destructive",className:"ml-2",children:q.length})]}),e.jsxs(U,{value:"settings",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"开发者设置"]})]}),e.jsx(A,{value:"users",children:e.jsxs(h,{children:[e.jsxs(m,{children:[e.jsx(j,{children:"用户列表"}),e.jsx(_,{children:"管理所有用户的角色和权限"})]}),e.jsx(u,{children:R?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(v,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(B,{children:[e.jsx(O,{children:e.jsxs(N,{children:[e.jsx(a,{children:"用户名"}),e.jsx(a,{children:"HTP余额"}),e.jsx(a,{children:"USDT余额"}),e.jsx(a,{children:"邀请人数"}),e.jsx(a,{children:"钱包状态"}),e.jsx(a,{children:"注册时间"}),e.jsx(a,{children:"角色"}),e.jsx(a,{className:"text-right",children:"操作"})]})}),e.jsx($,{children:g.map(s=>e.jsxs(N,{children:[e.jsx(t,{className:"font-medium",children:s.username}),e.jsx(t,{children:s.htp_balance.toFixed(2)}),e.jsx(t,{children:s.usdt_balance.toFixed(2)}),e.jsx(t,{children:s.total_invites}),e.jsx(t,{children:s.wallet_activated?e.jsx(c,{variant:"secondary",className:"bg-green-500/10 text-green-500",children:"已激活"}):e.jsx(c,{variant:"secondary",className:"bg-gray-500/10 text-gray-500",children:"未激活"})}),e.jsx(t,{className:"text-sm",children:new Date(s.created_at).toLocaleDateString("zh-CN")}),e.jsxs(t,{children:[s.role==="admin"&&e.jsx(c,{variant:"secondary",className:"bg-red-500/10 text-red-500",children:"管理员"}),s.role==="master_node"&&e.jsx(c,{variant:"secondary",className:"bg-primary/10 text-primary",children:"主节点"}),s.role==="user"&&e.jsx(c,{variant:"secondary",children:"普通用户"})]}),e.jsx(t,{className:"text-right space-x-2",children:e.jsx(o,{size:"sm",variant:"outline",onClick:()=>Ne(s),children:"编辑"})})]},s.id))})]})})})]})}),e.jsx(A,{value:"withdrawals",children:e.jsxs(h,{children:[e.jsxs(m,{children:[e.jsx(j,{children:"提币审核"}),e.jsx(_,{children:"审核用户的提币申请"})]}),e.jsx(u,{children:R?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(v,{className:"w-8 h-8 animate-spin text-primary"})}):L.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"暂无提币申请"}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(B,{children:[e.jsx(O,{children:e.jsxs(N,{children:[e.jsx(a,{children:"用户"}),e.jsx(a,{children:"代币"}),e.jsx(a,{className:"text-right",children:"数量"}),e.jsx(a,{children:"接收地址"}),e.jsx(a,{children:"付款地址"}),e.jsx(a,{children:"申请时间"}),e.jsx(a,{children:"状态"}),e.jsx(a,{className:"text-right",children:"操作"})]})}),e.jsx($,{children:L.map(s=>{const n=g.find(p=>p.id===s.user_id);return e.jsxs(N,{children:[e.jsx(t,{className:"font-medium",children:(n==null?void 0:n.username)||"未知用户"}),e.jsx(t,{children:e.jsx(c,{variant:"outline",children:s.token_type})}),e.jsx(t,{className:"text-right font-bold",children:s.amount.toFixed(2)}),e.jsxs(t,{className:"font-mono text-xs",children:[s.to_address.slice(0,10),"..."]}),e.jsx(t,{className:"font-mono text-xs",children:s.payment_address?s.payment_address.slice(0,10)+"...":"-"}),e.jsx(t,{className:"text-sm",children:new Date(s.created_at).toLocaleString("zh-CN")}),e.jsxs(t,{children:[s.status==="pending"&&e.jsx(c,{variant:"secondary",className:"bg-yellow-500/10 text-yellow-500",children:"待审核"}),s.status==="approved"&&e.jsx(c,{variant:"secondary",className:"bg-green-500/10 text-green-500",children:"已通过"}),s.status==="rejected"&&e.jsx(c,{variant:"secondary",className:"bg-red-500/10 text-red-500",children:"已拒绝"})]}),e.jsx(t,{className:"text-right",children:s.status==="pending"&&e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(o,{size:"sm",variant:"default",onClick:()=>f({open:!0,type:"withdrawal",id:s.id,action:"approve"}),children:"通过"}),e.jsx(o,{size:"sm",variant:"destructive",onClick:()=>f({open:!0,type:"withdrawal",id:s.id,action:"reject"}),children:"拒绝"})]})})]},s.id)})})]})})})]})}),e.jsx(A,{value:"masternodes",children:e.jsxs(h,{children:[e.jsxs(m,{children:[e.jsx(j,{children:"主节点审核"}),e.jsx(_,{children:"审核用户的主节点申请"})]}),e.jsx(u,{children:R?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(v,{className:"w-8 h-8 animate-spin text-primary"})}):z.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"暂无主节点申请"}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(B,{children:[e.jsx(O,{children:e.jsxs(N,{children:[e.jsx(a,{children:"用户"}),e.jsx(a,{children:"申请时间"}),e.jsx(a,{children:"目标"}),e.jsx(a,{children:"进度"}),e.jsx(a,{children:"状态"}),e.jsx(a,{className:"text-right",children:"操作"})]})}),e.jsx($,{children:z.map(s=>{const n=g.find(p=>p.id===s.user_id);return e.jsxs(N,{children:[e.jsx(t,{className:"font-medium",children:(n==null?void 0:n.username)||"未知用户"}),e.jsx(t,{className:"text-sm",children:new Date(s.applied_at).toLocaleString("zh-CN")}),e.jsx(t,{children:s.target_wallets.toLocaleString()}),e.jsx(t,{children:s.activated_wallets.toLocaleString()}),e.jsxs(t,{children:[s.status==="pending"&&e.jsx(c,{variant:"secondary",className:"bg-yellow-500/10 text-yellow-500",children:"待审核"}),s.status==="approved"&&e.jsx(c,{variant:"secondary",className:"bg-green-500/10 text-green-500",children:"已通过"}),s.status==="rejected"&&e.jsx(c,{variant:"secondary",className:"bg-red-500/10 text-red-500",children:"已拒绝"})]}),e.jsx(t,{className:"text-right",children:s.status==="pending"&&e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(o,{size:"sm",variant:"default",onClick:async()=>{await pe(s.user_id,"master_node"),i.success("主节点申请已通过")},children:"通过"}),e.jsx(o,{size:"sm",variant:"destructive",onClick:()=>f({open:!0,type:"masternode",id:s.id,action:"reject"}),children:"拒绝"})]})})]},s.id)})})]})})})]})}),e.jsx(A,{value:"settings",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(h,{children:[e.jsxs(m,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5"}),"开发者钱包地址管理"]}),e.jsx(_,{children:"管理接收USDT的开发者钱包地址（仅管理员可修改）"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"当前开发者地址"}),e.jsx("div",{className:"p-3 rounded-lg bg-accent/30 border border-border",children:e.jsx("p",{className:"font-mono text-sm break-all",children:V})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"newAddress",children:"新的开发者地址"}),e.jsx(C,{id:"newAddress",type:"text",placeholder:"输入新的BSC钱包地址",value:b,onChange:s=>J(s.target.value),className:"font-mono"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"此地址用于接收用户支付的钱包激活费用（30 USDT）"})]}),e.jsxs(o,{onClick:ve,disabled:K||b===V,className:"w-full hover-glow",children:[K&&e.jsx(v,{className:"mr-2 h-4 w-4 animate-spin"}),"更新开发者地址"]})]})]}),e.jsxs(h,{children:[e.jsxs(m,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5"}),"HTP价格管理"]}),e.jsx(_,{children:"根据市场需求调整HTP代币的显示价格"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"价格模式"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:w==="auto"?"default":"outline",onClick:()=>se("auto"),className:"flex-1",children:"自动计算"}),e.jsx(o,{variant:w==="manual"?"default":"outline",onClick:()=>se("manual"),className:"flex-1",children:"手动设置"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:w==="auto"?"自动模式：开盘价$0.01，每天递增$0.03":"手动模式：由管理员设置固定价格"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"当前HTP价格"}),e.jsx("div",{className:"p-3 rounded-lg bg-accent/30 border border-border",children:e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["$",me.toFixed(4)]})})]}),w==="manual"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"newPrice",children:"设置新价格（美元）"}),e.jsx(C,{id:"newPrice",type:"number",step:"0.0001",min:"0",placeholder:"输入新的HTP价格",value:k,onChange:s=>Y(s.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"设置后将立即生效，影响所有用户看到的HTP价格"})]}),w==="manual"&&e.jsxs(o,{onClick:fe,disabled:Z||!k||parseFloat(k)<=0,className:"w-full hover-glow",children:[Z&&e.jsx(v,{className:"mr-2 h-4 w-4 animate-spin"}),"更新HTP价格"]})]})]})]})})]}),e.jsx(te,{open:d.open,onOpenChange:s=>{s||(f({open:!1,type:null,id:null,action:null}),S(""))},children:e.jsxs(re,{children:[e.jsxs(le,{children:[e.jsx(ne,{children:d.action==="approve"?"确认通过":"确认拒绝"}),e.jsx(ie,{children:d.action==="approve"?"确认通过此申请吗？":"请填写拒绝原因"})]}),d.action==="reject"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"reject-reason",children:"拒绝原因"}),e.jsx(qe,{id:"reject-reason",placeholder:"请输入拒绝原因...",value:M,onChange:s=>S(s.target.value),rows:4})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(o,{variant:"outline",onClick:()=>{f({open:!1,type:null,id:null,action:null}),S("")},children:"取消"}),e.jsxs(o,{onClick:ge,disabled:T,variant:d.action==="approve"?"default":"destructive",children:[T&&e.jsx(v,{className:"mr-2 h-4 w-4 animate-spin"}),"确认"]})]})]})}),e.jsx(te,{open:he,onOpenChange:P,children:e.jsxs(re,{children:[e.jsxs(le,{children:[e.jsx(ne,{children:"编辑用户信息"}),e.jsx(ie,{children:"修改用户的余额、钱包状态和角色权限"})]}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"用户名"}),e.jsx(C,{value:l.username,disabled:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"htp_balance",children:"HTP余额"}),e.jsx(C,{id:"htp_balance",type:"number",step:"0.01",value:l.htp_balance,onChange:s=>y({...l,htp_balance:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"usdt_balance",children:"USDT余额"}),e.jsx(C,{id:"usdt_balance",type:"number",step:"0.01",value:l.usdt_balance,onChange:s=>y({...l,usdt_balance:parseFloat(s.target.value)||0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"role",children:"用户角色"}),e.jsxs("select",{id:"role",value:l.role,onChange:s=>y({...l,role:s.target.value}),className:"w-full border rounded px-3 py-2 bg-background",children:[e.jsx("option",{value:"user",children:"普通用户"}),e.jsx("option",{value:"master_node",children:"主节点"}),e.jsx("option",{value:"admin",children:"管理员"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"wallet_activated",checked:l.wallet_activated,onChange:s=>y({...l,wallet_activated:s.target.checked}),className:"w-4 h-4"}),e.jsx(x,{htmlFor:"wallet_activated",className:"cursor-pointer",children:"钱包已激活"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(o,{variant:"outline",onClick:()=>P(!1),children:"取消"}),e.jsxs(o,{onClick:be,disabled:T,children:[T&&e.jsx(v,{className:"mr-2 h-4 w-4 animate-spin"}),"保存"]})]})]})]})})]})}export{Xe as default};
