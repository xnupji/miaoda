import{c as O,u as Y,r as n,j as e,B as u,b as j,t as d,s as g}from"./index-ziWed5QJ.js";import{C as f,b as N,c as T,a as y,d as Z}from"./card-DwmZRHiX.js";import{T as ee,a as se,b as $,c as l,d as te,e as c}from"./table-BL6Da_e1.js";import{L as I,I as B}from"./label-CXqH5594.js";import{D as ae,a as re,b as ne,c as ie,d as le,e as ce}from"./dialog-2OLrIEvy.js";import{T as de,a as oe,b as v,c as me}from"./tabs-3K0ALqpF.js";import{a as xe,f as he}from"./api-BlmA4nJt.js";import{T as pe}from"./trending-up-Bi0d_E9o.js";import{L as E}from"./loader-circle-CXjkWSfc.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],H=O("arrow-right-left",ue);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],ge=O("trending-down",je),fe={mining:"挖矿奖励",invitation_reward:"邀请奖励",master_node_reward:"主节点奖励",withdrawal:"提币",transfer_in:"转入",transfer_out:"转出"},Ne={mining:"text-primary",invitation_reward:"text-chart-2",master_node_reward:"text-chart-3",withdrawal:"text-destructive",transfer_in:"text-green-500",transfer_out:"text-orange-500"};function Se(){var L;const{profile:a,refreshProfile:z}=Y(),[b,M]=n.useState([]),[R,P]=n.useState(!0),[o,q]=n.useState("all"),[V,w]=n.useState(!1),[m,x]=n.useState(""),[D,h]=n.useState(""),[i,G]=n.useState(.01),[p,_]=n.useState(!1);n.useEffect(()=>{S(),J()},[]);const J=async()=>{const s=await xe();G(s)},S=async()=>{P(!0);const s=await he(200);M(s),P(!1)},C=s=>{x(s);const t=parseFloat(s);if(!isNaN(t)&&t>0){const r=t*i;h(r.toFixed(4))}else h("")},K=s=>{h(s);const t=parseFloat(s);if(!isNaN(t)&&t>0&&i>0){const r=t/i;x(r.toFixed(4))}else x("")},Q=async()=>{const s=parseFloat(m),t=parseFloat(D);if(isNaN(s)||s<=0){d.error("请输入有效的HTP数量");return}if(!a||a.htp_balance<s){d.error("HTP余额不足");return}_(!0);try{const{data:{user:r}}=await g.auth.getUser();if(!r){d.error("请先登录"),_(!1);return}const{error:A}=await g.from("profiles").update({htp_balance:a.htp_balance-s,usdt_balance:(a.usdt_balance||0)+t}).eq("id",r.id);if(A)throw A;await g.from("transactions").insert({user_id:r.id,type:"transfer_out",amount:s,token_type:"HTP",status:"completed",description:`闪兑：HTP → USDT (汇率: $${i.toFixed(4)})`}),await g.from("transactions").insert({user_id:r.id,type:"transfer_in",amount:t,token_type:"USDT",status:"completed",description:`闪兑：HTP → USDT (汇率: $${i.toFixed(4)})`}),d.success(`成功兑换 ${s.toFixed(4)} HTP → ${t.toFixed(4)} USDT`),await z(),await S(),x(""),h(""),w(!1)}catch(r){console.error("闪兑失败:",r),d.error("闪兑失败，请稍后重试")}finally{_(!1)}},F=b.filter(s=>o==="all"?!0:s.token_type===o),k=b.filter(s=>s.token_type==="HTP"),U=b.filter(s=>s.token_type==="USDT"),W=k.filter(s=>["mining","invitation_reward","master_node_reward","transfer_in"].includes(s.type)).reduce((s,t)=>s+t.amount,0),X=k.filter(s=>["withdrawal","transfer_out"].includes(s.type)).reduce((s,t)=>s+t.amount,0);return U.filter(s=>["master_node_reward","transfer_in"].includes(s.type)).reduce((s,t)=>s+t.amount,0),U.filter(s=>["withdrawal","transfer_out"].includes(s.type)).reduce((s,t)=>s+t.amount,0),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold gradient-text",children:"交易记录"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"查看您的所有交易历史"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(f,{className:"glow-border",children:[e.jsx(N,{className:"pb-2",children:e.jsxs(T,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-green-500"}),"HTP 收入"]})}),e.jsx(y,{children:e.jsxs("div",{className:"text-2xl font-bold text-green-500",children:["+",W.toFixed(2)]})})]}),e.jsxs(f,{className:"glow-border",children:[e.jsx(N,{className:"pb-2",children:e.jsxs(T,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-red-500"}),"HTP 支出"]})}),e.jsx(y,{children:e.jsxs("div",{className:"text-2xl font-bold text-red-500",children:["-",X.toFixed(2)]})})]}),e.jsxs(f,{className:"glow-border-strong",children:[e.jsx(N,{className:"pb-2",children:e.jsxs(T,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-primary"}),"闪兑交易"]})}),e.jsx(y,{children:e.jsxs(ae,{open:V,onOpenChange:w,children:[e.jsx(re,{asChild:!0,children:e.jsx(u,{className:"w-full hover-glow",children:"HTP → USDT"})}),e.jsxs(ne,{children:[e.jsxs(ie,{children:[e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-primary"}),"闪兑交易"]}),e.jsx(ce,{children:"将您的HTP代币即时兑换成USDT"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-accent/30 border border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"当前汇率"}),e.jsxs("span",{className:"font-bold text-primary",children:["1 HTP = $",i.toFixed(4)," USDT"]})]})}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"可用HTP余额"}),e.jsxs("span",{className:"font-medium",children:[((L=a==null?void 0:a.htp_balance)==null?void 0:L.toFixed(4))||"0.0000"," HTP"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"htp-amount",children:"兑换数量（HTP）"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{id:"htp-amount",type:"number",step:"0.0001",min:"0",placeholder:"输入HTP数量",value:m,onChange:s=>C(s.target.value)}),e.jsx(u,{variant:"ghost",size:"sm",className:"absolute right-1 top-1 h-7 text-xs",onClick:()=>{var s;return C(((s=a==null?void 0:a.htp_balance)==null?void 0:s.toString())||"0")},children:"全部"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"p-2 rounded-full bg-primary/10",children:e.jsx(H,{className:"w-5 h-5 text-primary"})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"usdt-amount",children:"获得数量（USDT）"}),e.jsx(B,{id:"usdt-amount",type:"number",step:"0.0001",min:"0",placeholder:"自动计算",value:D,onChange:s=>K(s.target.value)})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50 text-xs text-muted-foreground space-y-1",children:[e.jsx("p",{children:"• 闪兑交易即时完成，无需等待"}),e.jsx("p",{children:"• 汇率根据当前HTP市场价格计算"}),e.jsx("p",{children:"• 兑换后的USDT可用于提现或其他用途"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:"outline",className:"flex-1",onClick:()=>w(!1),disabled:p,children:"取消"}),e.jsxs(u,{className:"flex-1 hover-glow",onClick:Q,disabled:p||!m||parseFloat(m)<=0,children:[p&&e.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}),p?"兑换中...":"确认兑换"]})]})]})]})]})})]})]}),e.jsxs(f,{children:[e.jsxs(N,{children:[e.jsx(T,{children:"交易历史"}),e.jsx(Z,{children:"所有交易记录按时间倒序排列"})]}),e.jsx(y,{children:e.jsxs(de,{value:o,onValueChange:s=>q(s),children:[e.jsxs(oe,{className:"mb-4",children:[e.jsx(v,{value:"all",children:"全部"}),e.jsx(v,{value:"HTP",children:"HTP"}),e.jsx(v,{value:"USDT",children:"USDT"})]}),e.jsx(me,{value:o,className:"mt-0",children:R?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(E,{className:"w-8 h-8 animate-spin text-primary"})}):F.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"暂无交易记录"})}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs($,{children:[e.jsx(l,{children:"时间"}),e.jsx(l,{children:"类型"}),e.jsx(l,{children:"代币"}),e.jsx(l,{className:"text-right",children:"金额"}),e.jsx(l,{children:"说明"}),e.jsx(l,{className:"text-right",children:"状态"})]})}),e.jsx(te,{children:F.map(s=>{const t=["mining","invitation_reward","master_node_reward","transfer_in"].includes(s.type);return e.jsxs($,{children:[e.jsx(c,{className:"text-sm",children:new Date(s.created_at).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsx(c,{children:e.jsx("span",{className:Ne[s.type],children:fe[s.type]})}),e.jsx(c,{children:e.jsx(j,{variant:"outline",children:s.token_type})}),e.jsx(c,{className:"text-right font-bold",children:e.jsxs("span",{className:t?"text-green-500":"text-red-500",children:[t?"+":"-",s.amount.toFixed(2)]})}),e.jsx(c,{className:"text-sm text-muted-foreground max-w-xs truncate",children:s.description||"-"}),e.jsxs(c,{className:"text-right",children:[s.status==="completed"&&e.jsx(j,{variant:"secondary",className:"bg-green-500/10 text-green-500",children:"已完成"}),s.status==="pending"&&e.jsx(j,{variant:"secondary",className:"bg-yellow-500/10 text-yellow-500",children:"处理中"}),s.status==="failed"&&e.jsx(j,{variant:"secondary",className:"bg-red-500/10 text-red-500",children:"失败"})]})]},s.id)})})]})})})]})})]})]})}export{Se as default};
