import{r as m,u as S,l as T,m as E,j as e,S as I,B as b,t as i}from"./index-Cn_29fsw.js";import{L as o,I as d}from"./label-D50YiGBT.js";import{C as D,b as R,c as A,d as B,a as M,L as y}from"./card-CiSmHLqO.js";import{T as k,a as z,b as N,c as C}from"./tabs-Cbw-3pQ0.js";function $(){var w;const[r,u]=m.useState(!1),[l,f]=m.useState({username:"",password:""}),[s,c]=m.useState({username:"",password:"",confirmPassword:"",invitationCode:""}),{signIn:v,signUp:L}=S(),p=T(),g=E(),[h,j]=m.useState("login"),x=((w=g.state)==null?void 0:w.from)||"/";m.useEffect(()=>{const n=new URLSearchParams(g.search).get("code");n&&(c(t=>({...t,invitationCode:n})),j("register"))},[g]);const P=async a=>{if(a.preventDefault(),!l.username||!l.password){i.error("请填写用户名和密码");return}u(!0);const{error:n}=await v(l.username,l.password);if(u(!1),n){let t=n.message;t.includes("Email not confirmed")?t="账号未验证（如果是旧账号，请在后台删除该用户后重新注册；如果是新账号，请检查后台“Email Provider”是否已开启）":t.includes("Invalid login credentials")&&(t="用户名或密码错误"),i.error("登录失败："+t)}else i.success("登录成功！"),p(x,{replace:!0})},F=async a=>{if(a.preventDefault(),!s.username||!s.password){i.error("请填写用户名和密码");return}if(s.password!==s.confirmPassword){i.error("两次输入的密码不一致");return}if(s.password.length<6){i.error("密码长度至少为6位");return}if(!/^[a-zA-Z0-9_]+$/.test(s.username)){i.error("用户名只能包含字母、数字和下划线，请勿输入邮箱地址");return}u(!0);const{data:n,error:t}=await L(s.username,s.password,s.invitationCode||void 0);if(u(!1),t)i.error("注册失败："+t.message);else if(i.success("注册成功！"),n!=null&&n.session)p(x,{replace:!0});else try{await v(s.username,s.password),p(x,{replace:!0})}catch{i.warning("注册成功但登录受限。请检查后台是否关闭了邮箱验证并启用了 Email Provider。")}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-primary/10 rounded-full blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-chart-3/10 rounded-full blur-3xl animate-pulse",style:{animationDelay:"1s"}})]}),e.jsxs(D,{className:"w-full max-w-md relative z-10 glow-border",children:[e.jsxs(R,{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx(I,{className:"w-12 h-12 text-primary"})}),e.jsx(A,{className:"text-3xl font-bold gradient-text",children:"HTP挖矿平台"}),e.jsx(B,{children:"基于BSC区块链的去中心化挖矿平台"})]}),e.jsx(M,{children:e.jsxs(k,{value:h,onValueChange:j,className:"w-full",children:[e.jsxs(z,{className:"grid w-full grid-cols-2",children:[e.jsx(N,{value:"login",children:"登录"}),e.jsx(N,{value:"register",children:"注册"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(C,{value:"login",forceMount:!0,hidden:h!=="login",children:e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"login-username",children:"用户名"}),e.jsx(d,{id:"login-username",type:"text",placeholder:"请输入用户名",value:l.username,onChange:a=>f({...l,username:a.target.value}),disabled:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"login-password",children:"密码"}),e.jsx(d,{id:"login-password",type:"password",placeholder:"请输入密码",value:l.password,onChange:a=>f({...l,password:a.target.value}),disabled:r})]}),e.jsxs(b,{type:"submit",className:"w-full hover-glow",disabled:r,children:[r&&e.jsx(y,{className:"mr-2 h-4 w-4 animate-spin"}),"登录"]})]})}),e.jsx(C,{value:"register",forceMount:!0,hidden:h!=="register",children:e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"register-username",children:"用户名"}),e.jsx(d,{id:"register-username",type:"text",placeholder:"字母、数字、下划线",value:s.username,onChange:a=>c({...s,username:a.target.value}),disabled:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"register-password",children:"密码"}),e.jsx(d,{id:"register-password",type:"password",placeholder:"至少6位",value:s.password,onChange:a=>c({...s,password:a.target.value}),disabled:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"register-confirm-password",children:"确认密码"}),e.jsx(d,{id:"register-confirm-password",type:"password",placeholder:"再次输入密码",value:s.confirmPassword,onChange:a=>c({...s,confirmPassword:a.target.value}),disabled:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"invitation-code",children:"邀请码（可选）"}),e.jsx(d,{id:"invitation-code",type:"text",placeholder:"如有邀请码请输入",value:s.invitationCode,onChange:a=>c({...s,invitationCode:a.target.value}),disabled:r})]}),e.jsxs(b,{type:"submit",className:"w-full hover-glow",disabled:r,children:[r&&e.jsx(y,{className:"mr-2 h-4 w-4 animate-spin"}),"注册"]})]})})]},h)]})})]})]})}export{$ as default};
