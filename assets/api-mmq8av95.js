import{s as a}from"./index-Cn_29fsw.js";async function d(r){const{data:e,error:t}=await a.from("platform_config").select("config_value").eq("config_key",r).maybeSingle();return t?(console.error("获取平台配置失败:",t),null):(e==null?void 0:e.config_value)||null}async function f(r){const{data:{user:e}}=await a.auth.getUser();if(!e)return!1;const{error:t}=await a.from("profiles").update({wallet_activated:!0,activation_paid_amount:r,activation_paid_at:new Date().toISOString()}).eq("id",e.id);return t?(console.error("激活钱包失败:",t),!1):!0}async function u(){const{data:{user:r}}=await a.auth.getUser();if(!r)return null;const{data:e,error:t}=await a.from("profiles").select("*").eq("id",r.id).maybeSingle();return t?(console.error("获取用户Profile失败:",t),null):e}async function g(r){const{data:{user:e}}=await a.auth.getUser();if(!e)return!1;const{error:t}=await a.from("profiles").update(r).eq("id",e.id);return t?(console.error("更新Profile失败:",t),!1):!0}async function m(){const{data:{user:r}}=await a.auth.getUser();if(!r)return!1;const e=new Date().toISOString().split("T")[0],{data:t,error:n}=await a.from("mining_records").select("id").eq("user_id",r.id).eq("mining_date",e).maybeSingle();return n?(console.error("检查挖矿记录失败:",n),!1):!!t}async function y(r){const{data:{user:e}}=await a.auth.getUser();if(!e)return{success:!1,message:"未登录"};if(typeof r!="number"||isNaN(r)||r<=0)return{success:!1,message:"无效的挖矿数量"};const t=new Date().toISOString().split("T")[0],{error:n}=await a.from("mining_records").insert({user_id:e.id,amount:r,mining_date:t});if(n)return console.error("创建挖矿记录失败:",n),{success:!1,message:"创建挖矿记录失败: "+n.message};const{error:s}=await a.rpc("increment_balance",{user_id:e.id,amount:r});if(s){console.warn("RPC调用失败，尝试直接更新:",s);const i=await u();if(!i)return{success:!1,message:"获取用户信息失败，请稍后重试"};const{error:o}=await a.from("profiles").update({htp_balance:i.htp_balance+r}).eq("id",e.id);if(o)return console.error("更新余额失败:",o),{success:!1,message:"更新余额失败: "+o.message}}return a.from("transactions").insert({user_id:e.id,type:"mining",amount:r,token_type:"HTP",status:"completed",description:"每日挖矿奖励"}).then(({error:i})=>{i&&console.error("创建交易记录失败:",i)}),{success:!0}}async function w(r=50){const{data:{user:e}}=await a.auth.getUser();if(!e)return[];const{data:t,error:n}=await a.from("mining_records").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(r);return n?(console.error("获取挖矿记录失败:",n),[]):Array.isArray(t)?t:[]}async function _(r=50){const{data:{user:e}}=await a.auth.getUser();if(!e)return[];const{data:t,error:n}=await a.from("transactions").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(r);return n?(console.error("获取交易记录失败:",n),[]):Array.isArray(t)?t:[]}async function p(){const{data:{user:r}}=await a.auth.getUser();if(!r)return[];const{data:e,error:t}=await a.from("invitations").select("*").eq("inviter_id",r.id).order("created_at",{ascending:!1});return t?(console.error("获取邀请列表失败:",t),[]):Array.isArray(e)?e:[]}async function h(){const{data:{user:r}}=await a.auth.getUser();if(!r)return!1;const{error:e}=await a.from("master_node_applications").insert({user_id:r.id,status:"pending",activated_wallets:0,target_wallets:1e5,total_rewards:0});return e?(console.error("申请主节点失败:",e),!1):!0}async function q(){const{data:{user:r}}=await a.auth.getUser();if(!r)return null;const{data:e,error:t}=await a.from("master_node_applications").select("*").eq("user_id",r.id).order("applied_at",{ascending:!1}).limit(1).maybeSingle();return t?(console.error("获取主节点申请失败:",t),null):e}async function A(){const{data:r,error:e}=await a.from("master_node_applications").select("*").order("applied_at",{ascending:!1});return e?(console.error("获取所有主节点申请失败:",e),[]):Array.isArray(r)?r:[]}async function v(r,e,t,n){const{data:{user:s}}=await a.auth.getUser();if(!s)return!1;const{error:i}=await a.from("withdrawal_requests").insert({user_id:s.id,amount:r,token_type:e,to_address:t,status:"pending",payment_address:n||null});return i?(console.error("创建提币请求失败:",i),!1):!0}async function S(){const{data:{user:r}}=await a.auth.getUser();if(!r)return[];const{data:e,error:t}=await a.from("withdrawal_requests").select("*").eq("user_id",r.id).order("created_at",{ascending:!1});return t?(console.error("获取提币请求失败:",t),[]):Array.isArray(e)?e:[]}async function U(){const{data:r,error:e}=await a.from("withdrawal_requests").select("*").order("created_at",{ascending:!1});return e?(console.error("获取所有提币请求失败:",e),[]):Array.isArray(r)?r:[]}async function b(r,e,t){const{data:{user:n}}=await a.auth.getUser();if(!n)return!1;const{error:s}=await a.from("withdrawal_requests").update({status:e,reviewed_at:new Date().toISOString(),reviewed_by:n.id,reject_reason:t||null}).eq("id",r);return s?(console.error("审核提币请求失败:",s),!1):!0}async function P(){const{data:r,error:e}=await a.from("profiles").select("*").order("created_at",{ascending:!1});return e?(console.error("获取所有用户失败:",e),[]):Array.isArray(r)?r:[]}async function M(r,e){const{error:t}=await a.from("profiles").update({role:e}).eq("id",r);return t?(console.error("更新用户角色失败:",t),!1):!0}async function c(r){const{data:e,error:t}=await a.from("system_settings").select("setting_value").eq("setting_key",r).maybeSingle();return t?(console.error("获取系统设置失败:",t),null):(e==null?void 0:e.setting_value)||null}async function T(r,e){const{data:{user:t}}=await a.auth.getUser();if(!t)return!1;const{error:n}=await a.from("system_settings").update({setting_value:e,updated_by:t.id}).eq("setting_key",r);return n?(console.error("更新系统设置失败:",n),!1):!0}async function k(){if(await c("htp_price_mode")==="manual"){const e=await c("htp_price");return e?parseFloat(e):.01}else{const e=new Date("2025-01-01");return .01+Math.floor((new Date().getTime()-e.getTime())/(1e3*60*60*24))*.03}}async function D(r=!0){let e=a.from("announcements").select("*").order("created_at",{ascending:!1});r&&(e=e.eq("is_active",!0));const{data:t,error:n}=await e;return n?(console.error("获取公告列表失败:",n),[]):Array.isArray(t)?t:[]}async function R(r){const{data:{user:e}}=await a.auth.getUser();if(!e)return!1;const{error:t}=await a.from("announcements").insert({...r,created_by:e.id});return t?(console.error("创建公告失败:",t),!1):!0}async function I(r,e){const{error:t}=await a.from("announcements").update(e).eq("id",r);return t?(console.error("更新公告失败:",t),!1):!0}async function N(r){const{error:e}=await a.from("announcements").delete().eq("id",r);return e?(console.error("删除公告失败:",e),!1):!0}export{D as a,k as b,m as c,p as d,q as e,h as f,w as g,_ as h,d as i,S as j,f as k,v as l,P as m,U as n,A as o,y as p,c as q,M as r,b as s,T as t,g as u,N as v,R as w,I as x};
